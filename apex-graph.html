<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <title>Graphic</title>
    <style>

    </style>
</head>
<body>

    <div id="chart">
    </div>
    <script>

    getChart();
    function getChart() {
        const SET_FIRSTHOUR = 6;
        const MAX_INT_TIME = 30;
        let checkIfAreThere = 0;
        let theHoursGet = 10;
        let categoriesChart = [ ]; // legend - time in half hour: 6:00, 6:30, 7:30 ... 16:30 without brakes - 30 minutes.
        let categoriesChartTimeInSec = [ ];
        let dataChart = [ ]; // blue line
        let remChart = [ ]; // black line

        // Time from X-Axis 
        for(let i = 0; i < getTimesArray(6, 17, 30).length; i++) {

            const result = new Date(Math.floor(hmsToSecondsOnly(getTimesArray(6, 17, 30)[i])) * 1000).toISOString().slice(11, 19);
            categoriesChart.push(result);


            categoriesChartTimeInSec.push(hmsToSecondsOnly(getTimesArray(6, 17, 30)[i]));

            //console.log(Math.floor(hmsToSecondsOnly(getTimesArray(6, 17, 30)[i])));
        }
        console.log(categoriesChartTimeInSec);

        // let converTimeInto = (from, inConv, params) => {
        //     let time = 0;
        //     switch(from) {
        //         case 'minutes': {
        //             if(inConv === 'hours') {
        //                 time = (params / 60);
        //                 return time;
        //             }
        //             else if(inConv === 'seconds') {
        //                 time = (params / 60);
        //                 return time;
        //             }
        //             else return false;
        //             break;
        //         }
        //         case 'hours': {
        //             if(inConv === 'minutes') {

        //             }
        //             else if(inConv === 'seconds') {
                        
        //             }
        //             else return false
        //             break;
        //         }
        //         case 'seconds': {
        //             if(inConv === 'hours') {

        //             }
        //             else if(inConv === 'minutes') {
                        
        //             }
        //             return return false
        //             break;
        //         }
        //     }
        // }

        // console.log(convertTimeInto(hours, minutes, 21600));
        //console.warn(dataChart.length);


        /* Update de Y Axis (How blue line are calc from getTimeRemain)  */
        for(let i = 0; i <= dataChart.length; i++) checkIfAreThere = i;
        
        if(theHoursGet > 0) 
            theHoursGet += (checkIfAreThere * MAX_INT_TIME);

        /* Calculate time (remain minutes) */
      
        // if(dataChart.length >= 1) {
        //     for(let i = 0; i < dataChart.length; i++) {
        //         for(let j = 0; j < categoriesChart.length; j++) {

        //             console.log(dataChart[i], categoriesChart[j]);
        //         }
        //     }
        // }
        
        // let todayDate = new Date ();
        // let hoursToday = todayDate.getHours();
        // let minutesToday = todayDate.getMinutes();
        // let lastHour = SET_FIRSTHOUR;
        // for(let i = 0; i < categoriesChartTimeInSec.length; i++) {
        //     for(let j = 0; j < categoriesChart.length; j++) {
        //         if(i === j) {
        //             if((hoursToday >= 6 && (hoursToday < 15 && minutesToday <= 31))) {
        //                 console.warn('DEBUG: Check time between program.');

        //                 if(hoursToday >= lastHour && minutesToday === 0) {
        //                     lastHour = hoursToday;

        //                     console.log(categoriesChartTimeInSec[i]); 
        //                 }
        //             }
        //             else {
        //                 console.warn('DEBUG: Check time between program, failure.');
        //             } 
                    
        //             let checkIsDeleted = categoriesChartTimeInSec.shift();
        //             console.log('First item was deleted: ', checkIsDeleted);

        //             console.log('Items from group: ', categoriesChartTimeInSec);
        //         }
        //     }
        // }


        
        /* Ajax Chart.js */ 
        var options = {
        series: [ {
            name: "Target",
            data: dataChart, 
        },{
            name: "Rem", 
            data: remChart,
        } ],
            chart: {
                height: 350,
                type: 'line',
                dropShadow: {
                    enabled: true,
                    color: '#000',
                    top: 18,
                    left: 7,
                    blur: 10,
                    opacity: 0.2
            },
                    toolbar: {
                    show: false
            }
        },
        colors: ['#77B6EA', '#545454'],
            dataLabels: {
            enabled: true,
        },
        stroke: {
            curve: 'smooth'
        },
        title: {
            text: 'Average Target & Rem time',
            align: 'left'
        },
        grid: {
            borderColor: '#e7e7e7',
            row: {
                colors: ['#f3f3f3', 'transparent'], // takes an array which will be repeated on columns
                opacity: 0.5
            },
        },
        markers: {
            size: 1
        },
        xaxis: {
            categories: categoriesChart, // time
            title: {
                text: 'Time X-Axis (6:00 - 14:30)'
            }
        },
        yaxis: {
            title: {
            text: 'Time'
        },
            min: 0,
            max: theHoursGet  // set averange
        },
            legend: {
            position: 'top',
            horizontalAlign: 'right',
            floating: true,
            offsetY: -25,
            offsetX: -5
        } 
    };
    var chart = new ApexCharts(document.querySelector("#chart"), options);
    chart.render();
}

    function getTimesArray(start, end, length) {
        let startMin = start * 60
        let endMin = end * 60
        let times = []

        while (startMin <= endMin){
            let mins = startMin % 60
            let hours = Math.floor(startMin / 60)
            let sec = 0;
            let timeString = hours.toString() + ":" +  mins.toString().padStart(2, '0') + ":" + sec.toString().padStart(2, '0')
            times.push(timeString)
            startMin += length
        }
        return times
    };

    /* Return hours, minutes or seconds in only seconds. */
    function hmsToSecondsOnly(strComm) {
        var p = strComm.split(':'),
            s = 0, m = 1;

        while (p.length > 0) {
            s += m * parseInt(p.pop(), 10);
            m *= 60;
        }

        return s;
    };
    
    // var toHHMMSS = (secs) => {
    // var sec_num = parseInt(secs, 10)
    // var hours   = Math.floor(sec_num / 3600)
    // var minutes = Math.floor(sec_num / 60) % 60
    // var seconds = sec_num % 60

    //     return [hours,minutes,seconds]
    //         .map(v => v < 10 ? "0" + v : v)
    //         .filter((v,i) => v !== "00" || i > 0)
    //         .join(":")
    // }

    // console.log(toHHMMSS(23400));
    // console.log(getTimesArray(6, 17, 30))
    // console.log(getTimesArray(4,8, 110))
    // const seconds = 21660;
    // const result = new Date(seconds * 1000).toISOString().slice(11, 19);
    // console.log(typeof result); // debug "00:10:00" (hh:mm:ss)

    // Task:
    // array > creste y Axis > proces calcul (360 / 480) * (minute from x Axys)
    </script>
</body>
</html>