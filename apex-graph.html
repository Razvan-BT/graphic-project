<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <title>Graphic</title>
    <style>

    </style>
</head>
<body>

    <div id="chart">
    </div>
    <script>

    getChart();

    function getChart() {
        const TIME_WORK = 8,
            SET_FIRSTHOUR = 6,
            debug_status = true,
            MAX_INT_TIME = 30;
        let checkIfAreThere = 0,
            startMinut = 0,
            theHoursGet = 10,
            categoriesChart = new Array(), // legend - time in half hour: 6:00, 6:30, 7:30 ... 16:30 without brakes - 30 minutes.
            dataChart = [ ], // start with 0 minutes.
            remChart = new Array(); // black line

        // Time from X-Axis 

        for(let i = 0; i < getTimesArray(6, 17, 30).length; i++) {

            let chartTime = getTimesArray(6, 17, 30)[i]; 
            const result = new Date(Math.floor(hmsToSecondsOnly(getTimesArray(6, 17, 30)[i])) * 1000).toISOString().slice(11, 19);
            categoriesChart.push(result);
            

            let d1 = new Date();
            let start = getTimesArray(6, 17, 30)[0]
            let d2 = new Date();
            let now = new Date(d2.getFullYear(), d2.getMonth(), d2.getDate(), d2.getHours(), d2.getMinutes(), d2.getSeconds());
            let timenow = chartTime.substring(0, 8); // ultima actualizare la // scot data
            
            timenow = timenow.substring(0, 5);  // scot secundele
            let getTime = timenow;
            if(debug_status ) console.log("debug: getTimeWorked: " +getTime);
            if(debug_status ) console.log("debug: now time: " +now);
            if(debug_status ) console.log("debug: start time: " +start);

            

            
            let lucrate = (timestringtoDate(chartTime) - timestringtoDate(start)) / 1000;  // 1000
            if (lucrate > 30600) lucrate = 28800; // time for 8.5 hours worked.
            else if (lucrate > 23400) lucrate = lucrate - 1800;
            else if (lucrate > 22800) lucrate = 21600;
            else if (lucrate > 12000) lucrate = lucrate - 1200;
            else if (lucrate > 10800) lucrate = 10800;

            const minlucrate = lucrate /60;
            const target = 360;

            let targetnow = target/480 * minlucrate;
            // (now < result)
            dataChart.push(targetnow);

        }

        /* Update de Y Axis (How blue line are calc from getTimeRemain)  */
        for(let i = 0; i < dataChart.length; i++) { checkIfAreThere = i; }
        
        if(theHoursGet > 0) theHoursGet += (checkIfAreThere * MAX_INT_TIME);

        if(debug_status) console.log("debug: dataChart: " +dataChart.length);
        if(debug_status) console.log("debug: checkIfAreThere: " +checkIfAreThere);

        let calculateTime = 0,
            time = new Date(), 
            calculateTimeBeta = 0;
        
        /* Ajax Chart.js */ 
        var options = {
        series: [ {
            name: "Target",
            data: dataChart, 
        },{
            name: "Rem", 
            data: remChart,
        } ],
            chart: {
                height: 350,
                type: 'line',
                dropShadow: {
                enabled: true,
                color: '#000',
                top: 18,
                left: 7,
                blur: 10,
                opacity: 0.2
            },
                toolbar: {
                show: false
            }
        },
        colors: ['#77B6EA', '#545454'],
            dataLabels: {
            enabled: true,
        },
        stroke: {
            curve: 'smooth'
        },
        title: {
            text: 'Average Target & Rem time',
            align: 'left'
        },
        grid: {
            borderColor: '#e7e7e7',
            row: {
                colors: ['#f3f3f3', 'transparent'], // takes an array which will be repeated on columns
                opacity: 0.5
            },
        },
        markers: {
            size: 1
        },
        xaxis: {
            categories: categoriesChart, // time
            title: {
                text: 'Time X-Axis (6:00 - 14:30)'
            }
        },
        yaxis: {
            title: {
            text: 'Time'
        },
            min: 0,
            max: theHoursGet  // set averange
        },
            legend: {
            position: 'top',
            horizontalAlign: 'right',
            floating: true,
            offsetY: -25,
            offsetX: -5
        } 
    };

    var chart = new ApexCharts(document.querySelector("#chart"), options);
    chart.render();
    }

    
    function timestringtoDate(timestring){
        let d = new Date(); // Creates a Date Object using the clients current time

        let [hours, minutes, seconds] = timestring.split(':');

        d.setHours(+hours); // Set the hours, using implicit type coercion
        d.setMinutes(minutes); // can pass Number or String - doesn't really matter
        d.setSeconds(seconds);
        return d;
    }

    function secondsToHms(seconds) {
        if (!seconds) return '';

        let duration = seconds;
        let hours = duration / 3600;
        duration = duration % (3600);

        let min = parseInt(duration / 60);
        duration = duration % (60);

        let sec = parseInt(duration);

        if (sec < 10) {
            sec = `0${sec}`;
        }
        if (min < 10) {
            min = `0${min}`;
        }

        if (parseInt(hours, 10) > 0) {
            return `${parseInt(hours, 10)}h ${min}m ${sec}s`
        }
        else if (min == 0) {
            return `${sec}s`
        }
        else {
            return `${min}m ${sec}s`
        }
    }

    function getTimesArray(start, end, length) {
        let startMin = start * 60
        let endMin = end * 60
        let times = []

        while (startMin <= endMin){
            let mins = startMin % 60
            let hours = Math.floor(startMin / 60)
            let sec = 0;
            let timeString = hours.toString() + ":" +  mins.toString().padStart(2, '0') + ":" + sec.toString().padStart(2, '0')
            times.push(timeString)
            startMin += length
        }
        return times
    };

   
    /* Return hours, minutes or seconds in only seconds. */
    function hmsToSecondsOnly(strComm) {
        var p = strComm.split(':'),
            s = 0, m = 1;

        while (p.length > 0) {
            s += m * parseInt(p.pop(), 10);
            m *= 60;
        }

        return s;
    };
    
    </script>
</body>
</html>